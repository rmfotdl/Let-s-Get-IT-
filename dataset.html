<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>지뢰찾기 게임</title>

  <style>
    table {border-collapse: collapse;}
    td {border: 1px solid #bbb; text-align: center; line-height: 20px; width:20px; height:20px; background:#888;}
    td.poende {background:white;}
    td.flag {background:red;}
    td.question {background:orange;}
  </style>
</head>
<body>
  <!-- <input type="number" id="hor" placeholder="가로" value="10">
  <input type="number" id="ver" placeholder="세로" value="10">
  <input type="number" id="mine" placeholder="지뢰" value="20">
  <button id="exec">실행</button> -->
  <table id="table">
    <tbody></tbody>
  </table>
  <div id="result"></div>
</body>

<script>
  // const execute = document.querySelector('#exec');
  // const horizontal = document.querySelector('#hor').value;
  // const vertical = document.querySelector('#ver').value;
  const $tbody = document.querySelector('#table tbody');
  const $result = document.querySelector('#result');
  const row = 10; //줄
  const cell = 10; //칸
  const mine = 10;
  const CODE = {
    NORMAL : -1,
    QUESTION : -2,
    FLAG : -3,
    QUESSTION_MINE : -4,
    FLAG_MINE : -5,
    MINE : -6,
    OPENED : 0, //0 이상이면 모두 열린칸
  }
  let data;

  function plantMine(){
    const candidata = Array(row*cell).fill().map((arr,i)=>{return i});

    const shuffle = [];

    while(candidata.length > row*cell -mine){
      const cheson = candidata.splice(Math.floor(Math.random()*candidata.length),1)[0];
      shuffle.push(cheson)
    }

    const data = [];

    for(let i=0; i<row; i++){// 10번 반복 -1 10개짜리 이차원배열 10개  data에 추가
      const rowData =[];
      data.push(rowData);
      for(let j=0; j<cell; j++){ //-1배열 10개 rowData에 추가
        rowData.push(CODE.NORMAL);
      } 
    }    

    for(let k=0; k<shuffle.length; k++){
      const ver = Math.floor(shuffle[k]/cell);
      const hor = shuffle[k]%cell;
      data[ver][hor] = CODE.MINE;
    }

    return data;
  }

  function drowTable(){
    data = plantMine();
    data.forEach((row)=>{
      const $tr = document.createElement('tr');
      row.forEach((cell)=>{
        const $td = document.createElement('td');
        if(cell === CODE.MINE){
          $td.textContent='x';
        }
        $tr.append($td);
      })
      $tbody.append($tr);
      $tbody.addEventListener('contextmenu', onRightClick);
    })
  }

  drowTable();

  function onRightClick(event){
    event.preventDefault();
    const target = event.target;
    const rowIndex = target.parentNode.rowIndex;
    const cellIndex = target.cellIndex;

    const cellData = data[rowIndex][cellIndex];

    if(cellData === CODE.MINE){ //지뢰면
      data[rowIndex][cellIndex] = CODE.QUESSTION_MINE; // 물음표 지뢰로 변경
      target.className = 'question';
      target.textContent ='?';
    }else if(cellData === CODE.QUESSTION_MINE){ // 물음표 지뢰면
      data[rowIndex][cellIndex] = CODE.FLAG_MINE; //깃발 지뢰로
      target.className ='flag';
      target.textContent ='!';
    }else if(cellData === CODE.FLAG_MINE){//깃발지뢰면
      data[rowIndex][cellIndex] = CODE.MINE;
      target.className ='';
      target.textContent='x'
    }else if(cellData === CODE.NORMAL){//닫힌칸이면
      data[rowIndex][cellIndex]=CODE.QUESTION; //물음표로
      target.className = 'question';
      target.textContent="?";
    }else if(cellData === CODE.QUESTION){
      data[rowIndex][cellIndex]=CODE.FLAG//닫힌 칸으로
      target.className ='flag';
      target.textContent ='!';
    }else if(cellData ===CODE.FLAG){ //깃발이면
      data[rowIndex][cellIndex]=CODE.NORMAL//닫힌 칸으로
      target.className = '';
      target.textContent='';
    }
  }

</script>

</html>